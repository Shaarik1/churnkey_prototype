<!DOCTYPE html>
<html>
<head>
    <title>My Subscription Settings</title>
    <style>
        /* 1. simple CSS to make it look nice */
        body { font-family: sans-serif; background-color: #f4f4f4; display: flex; justify-content: center; padding-top: 50px; }
        .card { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 400px; }
        h2 { margin-top: 0; }
        .plan-info { background: #eef; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        
        /* The "Danger Zone" Button */
        .btn-cancel { background: #ff4d4d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%; font-size: 16px; }
        .btn-cancel:hover { background: #cc0000; }

        /* THE POPUP (Hidden by default) */
        #retention-modal {
            display: none; /* Hidden! */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center; justify-content: center;
        }
        .modal-content { background: white; padding: 30px; border-radius: 10px; text-align: center; width: 300px; }
        .btn-accept { background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px; width: 100%; }
        .btn-close { background: #ccc; border: none; padding: 5px 10px; margin-top: 10px; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="card">
        <h2>Manage Subscription</h2>
        <div class="plan-info">
            <strong>Current Plan:</strong> Pro Monthly<br>
            <strong>Price:</strong> $100.00 / month
        </div>
        <button class="btn-cancel" onclick="showRetentionOffer()">Cancel Subscription</button>
    </div>

    <div id="retention-modal">
        <div class="modal-content">
            <h2>Wait! Don't go.</h2>
            <p>We'll give you <strong>50% OFF</strong> your next month if you stay.</p>
            
            <button class="btn-accept" onclick="acceptOffer()">üéÅ Accept 50% Off</button>
            
            <br>
            <button class="btn-close" onclick="closeModal()">No thanks, really cancel</button>
        </div>
    </div>

    <script>
        // 1. Show the popup when they click Cancel
        function showRetentionOffer() {
            document.getElementById('retention-modal').style.display = 'flex';
        }

        // 2. Hide the popup
        function closeModal() {
            document.getElementById('retention-modal').style.display = 'none';
            alert("Okay, sending you to the cancellation page...");
        }

        // 3. TALK TO YOUR PYTHON BACKEND
        async function acceptOffer() {
            const customerId = "user_" + Math.floor(Math.random() * 1000); // Random User ID
            
            // We use 'fetch' to send a POST request to your running server
            // Note: We are using URL parameters just like in Swagger
            const url = `/accept-offer?customer_id=${customerId}&offer_type=50_percent_off`;

            try {
                const response = await fetch(url, { method: 'POST' });
                const data = await response.json();

                if (data.status === "success") {
                    alert("Success! " + data.message + "\n(Check your Python terminal!)");
                    document.getElementById('retention-modal').style.display = 'none';
                }
            } catch (error) {
                alert("Error connecting to backend! Is your Python server running?");
            }
        }
    </script>

</body>
</html>