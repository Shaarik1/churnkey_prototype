<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - RetainAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: white; }
        .mesh-bg { background-image: radial-gradient(circle at 15% 50%, rgba(59, 130, 246, 0.1), transparent 25%), radial-gradient(circle at 85% 30%, rgba(147, 51, 234, 0.1), transparent 25%); min-height: 100vh; }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="mesh-bg flex h-screen overflow-hidden">
    <aside class="w-64 glass-panel border-r-0 border-r border-white/10 hidden md:flex flex-col">
        <div class="p-6">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center font-bold text-white">R</div>
                <span class="font-bold text-lg tracking-tight">RetainAI</span>
            </div>
        </div>
        <nav class="flex-1 px-4 space-y-1">
            <a href="/dashboard" class="flex items-center gap-3 px-4 py-3 bg-blue-600/20 text-blue-400 rounded-lg font-medium transition">Overview</a>
            <a href="/settings" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition">Offer Logic</a>
            <a href="/setup" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white hover:bg-white/5 rounded-lg transition">Integration</a>
            <a href="/logout" class="flex items-center gap-3 px-4 py-3 text-red-400 hover:bg-red-500/10 rounded-lg transition mt-4">Sign Out</a>
        </nav>
        <div class="p-4 border-t border-white/10">
            <div class="bg-white/5 rounded-lg p-3 border border-white/5">
                <p class="text-xs text-gray-500 font-semibold uppercase">Your Commission</p>
                <p class="text-lg font-bold text-white" id="commission-sidebar">$0.00</p>
            </div>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-8">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div><h1 class="text-2xl font-bold text-white">Dashboard</h1></div>
            <div class="flex items-center gap-3 bg-white/5 p-2 rounded-lg border border-white/10">
                <input type="month" id="month-picker" onchange="refreshStats()" class="outline-none text-gray-300 font-bold bg-transparent cursor-pointer color-white">
                <div class="w-px h-6 bg-white/10 mx-1"></div>
                <button onclick="clearFilter()" class="text-xs text-blue-400 font-bold hover:text-blue-300 px-2">All Time</button>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="glass-panel p-6 rounded-xl">
                <h3 class="text-gray-400 text-sm font-medium mb-1">Total Revenue Saved</h3>
                <p class="text-3xl font-bold text-white" id="total-saved">$0.00</p>
            </div>
            <div class="glass-panel p-6 rounded-xl">
                <h3 class="text-gray-400 text-sm font-medium mb-1">Verified Deals</h3>
                <p class="text-3xl font-bold text-white" id="verified-deals">0</p>
            </div>
            <div class="glass-panel p-6 rounded-xl">
                <h3 class="text-gray-400 text-sm font-medium mb-1">Pending Saves</h3>
                <p class="text-3xl font-bold text-white" id="pending-deals">0</p>
            </div>
        </div>

        <div class="glass-panel rounded-xl overflow-hidden">
            <div class="px-6 py-4 border-b border-white/10 bg-white/5">
                <h3 class="font-bold text-gray-300">Recent Activity</h3>
            </div>
            <table class="w-full text-left text-sm text-gray-400">
                <tbody id="activity-table" class="divide-y divide-white/10"><tr><td class="p-6 text-center">Loading...</td></tr></tbody>
            </table>
        </div>
    </main>
    <script>
        async function refreshStats() {
            const m = document.getElementById('month-picker').value;
            const res = await fetch('/dashboard-stats' + (m ? `?month=${m}` : ''));
            if(res.status===401) window.location.href='/login';
            const data = await res.json();
            document.getElementById('total-saved').innerText = "$" + data.total_revenue_saved.toFixed(2);
            document.getElementById('verified-deals').innerText = data.verified_deals;
            document.getElementById('pending-deals').innerText = data.pending_deals;
            document.getElementById('commission-sidebar').innerText = "$" + data.your_commission.toFixed(2);
            const tb = document.getElementById('activity-table');
            tb.innerHTML = '';
            data.recent_activity.forEach(i => {
                tb.innerHTML += `<tr class="hover:bg-white/5"><td class="px-6 py-4">${i.customer_id}</td><td class="px-6 py-4">${i.offer_type}</td><td class="px-6 py-4 text-green-400">$${i.saved_amount}</td><td class="px-6 py-4">${i.status}</td></tr>`;
            });
        }
        function clearFilter(){ document.getElementById('month-picker').value=''; refreshStats(); }
        refreshStats();
    </script>
</body>
</html>